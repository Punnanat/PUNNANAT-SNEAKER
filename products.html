<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© | SNEAKER SPECIAL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Sarabun', sans-serif; background: #ede9fe; margin: 0; }
    .gallery-container { max-width: 1100px; margin: 40px auto; }
    .gallery-title { text-align: center; font-size: 2em; margin-bottom: 24px; }
    .product-grid { display: flex; flex-wrap: wrap; gap: 32px; justify-content: center; }
    .product-card {
      background: #fff; border-radius: 18px; box-shadow: 0 2px 8px #0001;
      width: 300px; padding: 20px; display: flex; flex-direction: column; align-items: center;
    }
    .product-card img { width: 200px; border-radius: 12px; }
    .product-name { font-size: 1.1em; font-weight: bold; margin: 10px 0 4px 0; }
    .product-meta { color: #555; font-size: 0.97em; margin-bottom: 8px; text-align: center; }
    .product-price { font-size: 1.1em; color: #7c3aed; margin-bottom: 10px; }
    .product-btn { background: #7c3aed; color: #fff; border: none; border-radius: 8px; padding: 10px 24px; font-size: 1em; cursor: pointer; }
    .product-btn:hover { background: #5b21b6; }
    .logout-btn { position: fixed; top: 20px; right: 30px; background: #ff1900; color: #fff; border: none; border-radius: 8px; padding: 8px 18px; font-size: 1em; cursor: pointer; }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

  <div class="gallery-container">
    <div class="gallery-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏£‡∏∏‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≠‡∏á</div>
    <div id="clockDisplay" style="text-align:center; font-weight:bold; color:#7c3aed; margin-bottom:12px;"></div>

    <div style="text-align:center; margin-bottom:20px; font-size:1.1em;">
  üë§ Username: <span id="userName" style="font-weight:bold;"></span><br>
  üìß Email: <span id="userEmail" style="font-weight:bold;"></span>
</div>

    <div class="product-grid" id="productGrid"></div>
  </div>

  <script>
  const user = JSON.parse(localStorage.getItem('currentUser'));
  if (user) {
    document.getElementById('userName').innerText = user.name;
    document.getElementById('userEmail').innerText = user.email;
  } else {
    window.location.href = "index.html"; // redirect ‡∏Å‡∏•‡∏±‡∏ö‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  }
  function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString('th-TH', {
      hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
    });
    document.getElementById('clockDisplay').innerText = "‡πÄ‡∏ß‡∏•‡∏≤: " + time;
  }
  setInterval(updateClock, 1000);
  updateClock();

  const SHEET_URL = "https://script.google.com/macros/s/AKfycbxkeL6im4QZ36cpluH9sTcmJp_wK2Gal8RIxEtdw_cYtRiTgp5HFJpp0a-RDGp9XAzM/exec";

  const products = [
    {
      id: "blackcat",
      name: 'Nike Air Jordan 4 "Black Cat" 2024',
      code: "CU1110-010",
      price: 8900,
      img: "https://www.sneakerfiles.com/wp-content/uploads/2024/08/air-jordan-4-rm-black-cat-FQ7939-004-release-info-1024x725.jpg",
      release: "25 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2025",
      stock: 5
    },
    {
      id: "travis1",
      name: 'Nike Air Jordan 1 Low OG "Travis Scott"',
      code: "DM7866-162",
      price: 15900,
      img: "https://2app.kicksonfire.com/kofapp/upload/events_images/ipad_travis-scott-x-air-jordan-1-low-og-black-olive-0.png",
      release: "25 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2025",
      stock: 5
    },
    {
      id: "yeezy",
      name: 'adidas Yeezy Boost 350 V2 "Zebra"',
      code: "CP9654",
      price: 12500,
      img: "https://www.sneakerfiles.com/wp-content/uploads/2018/10/adidas-yeezy-boost-350-v2-zebra-restock.jpg",
      release: "25 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2025",
      stock: 5
    },
    {
      id: "offwhite",
      name: 'Nike Air Presto Off-White',
      code: "AA3830-001",
      price: 32000,
      img: "https://www.kickgame.com/cdn/shop/products/Nike-Air-Presto-OW-AA3830-100-White_1.png?v=1658243604",
      release: "25 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2025",
      stock: 5
    }
  ];

  function renderSkeleton() {
    const htmlArray = products.map(p => `
      <div class="product-card" id="card-${p.code}">
        <img src="${p.img}" alt="${p.name}">
        <div class="product-name">${p.name}</div>
        <div class="product-meta">
          ‡∏£‡∏´‡∏±‡∏™: ${p.code}<br>
          ‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏≤‡∏¢: ${p.release}<br>
          ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.stock} ‡∏Ñ‡∏π‡πà<br>
          <span id="status-${p.code}" style="color:#999;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å...</span>
        </div>
        <div class="product-price">‡∏ø${p.price.toLocaleString()}</div>
        <button class="product-btn" id="btn-${p.code}" onclick="window.location.href='order.html?product=${p.id}'">‡∏à‡∏≠‡∏á</button>
      </div>
    `);
    document.getElementById('productGrid').innerHTML = htmlArray.join('');
  }

  async function updateStockStatus() {
    for (const p of products) {
      try {
        const res = await fetch(`${SHEET_URL}?checkStock=true&code=${p.code}`);
        const data = await res.json();
        const count = data.count;
        const isFull = count >= p.stock;

        const statusEl = document.getElementById(`status-${p.code}`);
        const btnEl = document.getElementById(`btn-${p.code}`);

        if (isFull) {
          statusEl.innerText = '‚ùå ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß';
          statusEl.style.color = 'red';
          btnEl.disabled = true;
          btnEl.style.background = '#ccc';
          btnEl.innerText = '‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß';
        } else if (p.stock - count <= 2) {
          statusEl.innerText = '‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà‡∏Ñ‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß';
          statusEl.style.color = '#f59e0b';
        } else {
          statusEl.innerText = '‚úî ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß';
          statusEl.style.color = '#16a34a';
        }
      } catch (err) {
        console.error("‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
        const statusEl = document.getElementById(`status-${p.code}`);
        statusEl.innerText = '‚ö†Ô∏è ‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ';
        statusEl.style.color = '#999';
      }
    }
  }

  renderSkeleton();
  updateStockStatus();

  function logout() {
    localStorage.removeItem('currentUser');
    window.location.href = "https://punnanat.github.io/PUNNANAT-SNEAKER/";
  }
</script>
</body>
</html>
